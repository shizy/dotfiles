#!/bin/bash

show () {
    xdotool search --name $1 windowmap
}

hide () {
    xdotool search --onlyvisible --name $1 windowunmap
}

create () {

    res=$(bspc query -T -m | head -n 1 | awk '{print $2}')
    res=(${res//[x|\+]/ })
    w_top=$((1 + ${res[3]}))
    w_left=${res[2]}

    if [ $2 ]; then
        cmd="-e $2 &"
    else
        cmd=''
    fi

    case $1 in
        "top")
            x=$w_left
            y=$w_top
            h=$((${res[1]} / 2))
            w=${res[0]}
            ;;
        "bottom" | "search")
            x=$w_left
            y=$(((${res[1]} / 2) + $w_top))
            h=$((${res[1]} / 2))
            if [ $1 == "search" ]; then
                y=$((${res[1]} - (${res[1]} / 3) + $w_top))
                h=$((${res[1]} / 3))
            fi
            w=${res[0]}
            ;;
        "left")
            x=$w_left
            y=$w_top
            h=${res[1]}
            w=$((${res[0]} / 2))
            ;;
        "right")
            x=$((${res[0]} / 2))
            y=$w_top
            h=${res[1]}
            w=$((${res[0]} / 2))
            ;;
        "jeeves")
            x=100
            y=100
            h=400
            w=400
            ;;
    esac

    [ "$1" == "jeeves" ] &&
        config=$XDG_CONFIG_HOME/termite/config.nav ||
        config=$XDG_CONFIG_HOME/termite/config.light

    termite -c $config --geometry ${w}x${h} --title=$1 $cmd &
    until [ $(xdotool search --name $1) ]; do :
    done
    xdotool search --name $1 windowmove $x $y
}

case $2 in
    "show") show $1 || create $1 $3;;
    "hide") hide $1;;
    *) hide $1 || show $1 || create $1 $2;;
esac

if [ "$1" != "jeeves" ]; then
    bspc window $(printf "0x%x\n" $(xdotool search --name $1) | head -n 1) -d focused -f
fi
