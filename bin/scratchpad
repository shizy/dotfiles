#!/bin/bash

running=$(swaymsg -t get_tree | grep -c "\"app_id\": \"$1\"")
window_height_percentage=46
window_width_percentage=80
yadjust=0
direction=""

workspace_height=$(swaymsg -t get_outputs | jq '. | map(select(.active == true) | .rect) | .[].height' | head -n 1)
workspace_half_height=$((workspace_height / 2 + 14))
window_half_height=$(($workspace_height * $window_height_percentage / 100 / 2))
yadjust=$((workspace_half_height - window_half_height))

case $1 in
    "scratchtop")
        direction="up"
        ;;
    "scratchbottom")
        direction="down"
        ;;
    *)
        exit
        ;;
esac

positioning="resize set width ${window_width_percentage}ppt height ${window_height_percentage}ppt, move position center, move ${direction} ${yadjust}px, move ${direction} 5px"

# if not running, spawn scratchpad based on direction and workspace size
if [ $running == 0 ]; then

    cmd="tmux -f $XDG_CONFIG_HOME/tmux/tmux.conf new-session -s $1"

    if [ $2 ]; then
       cmd="${@:2}"
    fi

    /usr/bin/alacritty --config-file=<(cat $XDG_CONFIG_HOME/alacritty/alacritty.yml | sed -e 's/#padding//g' -e 's/#scroll//g') --class="$1" -e fish -c "swaymsg [app_id=\"$1\"] floating enable, $positioning, move scratchpad, scratchpad show" -c "$cmd"
else
    swaymsg "[app_id=\"$1\"] scratchpad show, $positioning"
fi
