#!/bin/bash

running=$(swaymsg -t get_tree | grep -c "\"app_id\": \"$1\"")
window_height_percentage=46
window_width_percentage=80
yadjust=0
direction=""

workspace_height=$(swaymsg -t get_outputs | jq '. | map(select(.active == true) | .rect) | .[].height' | head -n 1)
workspace_half_height=$((workspace_height / 2))
window_half_height=$(($workspace_height * $window_height_percentage / 100 / 2))
yadjust=$((workspace_half_height - window_half_height))

case $1 in
    "scratchtop")
        direction="up"
        ;;
    "scratchbottom")
        direction="down"
        ;;
    *)
        exit
        ;;
esac

positioning="resize set width ${window_width_percentage}ppt height ${window_height_percentage}ppt, move position center, move ${direction} ${yadjust}px"

# if not running, spawn scratchpad based on direction and workspace size
if [ $running == 0 ]; then

    alacritty --config-file=$XDG_CONFIG_HOME/alacritty/scratch.yml --class="$1" --command fish -c "swaymsg [app_id=\"$1\"] floating enable, $positioning, move scratchpad, scratchpad show" -c "fish ${@:2}"
else
    swaymsg "[app_id=\"$1\"] scratchpad show, $positioning"
fi
