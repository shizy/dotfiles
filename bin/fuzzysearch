#!/bin/bash

# fzf default options defined in .zprofile

case $1 in
    "file")
        sel=$(fzf --prompt="$1 > " <<< $(rg --ignore-file $XDG_CONFIG_HOME/ag/agignore --hidden --no-messages --files /etc $HOME $PRIVATE))
        for file in ${sel[@]}
        do
            ftype=$(file $file --mime-type | awk '{print $file}')

            case $ftype in
                *"image"*)
                    feh $file > /dev/null
                    ;;
                *"text"* | *"empty"* | *"javascript"*)
                    python -c "from neovim import attach; nvim=attach('socket', path='$XDG_RUNTIME_DIR/nvim'); nvim.command('bad $file');"
                    ;;
                *"pdf"*)
                    zathura --fork $file
                    ;;
                *"video"*)
                    mplayer $file > /dev/null
                    ;;
                *"symlink"*)
                    target=$(readlink $file)
                    launch $1 $target
                    ;;
            esac
        done
        ;;
    "man")
        sel=$(fzf --prompt="$1 > " <<< $(/usr/bin/man -k "" | awk '{print $1,$2}'))
        for man in ${sel[@]}
        do
            python -c "from neovim import attach; nvim=attach('socket', path='$XDG_RUNTIME_DIR/nvim'); nvim.command('Man $man');"
        done
        ;;
    "kill")
        sel=$(fzf --prompt="$1 > " <<< $(ps -eo "%p : %U %c %a" | tail -n +2))
        for proc in ${sel[@]}
        do
            if [ "x$proc" != "x" ]
            then
                kill -9 $proc
            fi
        done
        ;;
    "ssh")
        sel=$(fzf --prompt="$1 > " <<< $(cat $PRIVATE/ssh/ssh_config | grep -oP '(?<=Host\ ).*?$'))
        for loc in ${sel[@]}
        do
            tmux new-session -d -s "ssh-$loc" "$LOCALDIR/bin/ssh $loc"
        done
        ;;
esac
