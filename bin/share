#!/bin/bash

if [ $# -eq 0 ]; then
    filename=$(date "+%m-%d-%y_%H_%M_%S")
    filetype=""
    input=$(cat)
else
    # check if valid file, then get type!
    if [ -f $* ]; then
        fullpath="$(pwd)/$*"
        filename=$(basename $*)
        filetype=$(file --mime-type $* | grep -oP ':\ \K\w+')
        input=$(cat $*)
    else
        echo "File does not exist or cannot be accessed"
        exit
    fi
fi

case $filetype in
    "") ;&
    "text")
        input=$(echo -n "$input" | python -c 'import json,sys; print (json.dumps(sys.stdin.read()))')
        output=$(curl -s -X POST -d "{\"public\":true,\"files\":{\"$filename\":{\"content\":$input}}}" https://api.github.com/gists |\
            grep -oP '"html_url":\ "\K.*(?=")' | head -n 1)
        ;;
    "image")
        client_id="7391112697a2a0e"
        output=$(curl -s -X POST -H "Authorization: Client-ID $client_id" -F "image=@$fullpath" https://api.imgur.com/3/image | grep -oP '"link":"\K.*?(?=")' | sed -e 's/\\//g')
        ;;
    *)
        # if directory, zip then upload!
        # file share
        ;;
esac

echo $output
$BROWSER $output 2>/dev/null
